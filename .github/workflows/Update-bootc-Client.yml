name: Update Bootc Client

on:
  push:
    branches: [main]
  workflow_dispatch:

env:
  IMAGE_NAME: my_dashboard
  IMAGE_VERSION: ${{ github.sha_short }}

jobs:
  update:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4

      # 1. 업데이트용 이미지 빌드
      - name: Build with Containerfile_Update
        run: |
          podman build -f Containerfile_Update \
            -t harbor.bootc.com/smarthome/$IMAGE_NAME:$IMAGE_VERSION .

      # 2. Harbor 푸시
      - name: Push to Harbor
        run: |
          podman login -u ${{ secrets.HARBOR_USER }} -p ${{ secrets.HARBOR_PASSWORD }} harbor.bootc.com
          podman push harbor.bootc.com/smarthome/$IMAGE_NAME:$IMAGE_VERSION
          podman tag harbor.bootc.com/smarthome/$IMAGE_NAME:$IMAGE_VERSION harbor.bootc.com/smarthome/$IMAGE_NAME:latest
          podman push harbor.bootc.com/smarthome/$IMAGE_NAME:latest
